# 通話モードページの折りたたみ可能セクション追加

## 概要

通話モードページ（CallModePage.tsx）の「近隣買主リスト」と「実績」のセクションを、ボタンをクリックすることで表示/非表示を切り替えられるようにします。

## 背景

現在、通話モードページ（CallModePage.tsx）には「近隣買主リスト」と「実績」のセクションが常に表示されていますが、画面が長くなりすぎて見づらくなっています。ユーザーが必要な時だけこれらの情報を表示できるようにするため、折りたたみ機能を追加します。

## ユーザーストーリー

### US-1: 近隣買主リストの表示/非表示切り替え
**As a** 営業担当者  
**I want to** 通話モードページで「近隣買主リスト」ボタンをクリックして近隣買主リストを表示/非表示できる  
**So that** 必要な時だけ近隣買主の情報を確認でき、画面をすっきり保てる

**受け入れ基準**:
1. 通話モードページの「近隣買主リスト」セクションが`CollapsibleSection`コンポーネントでラップされる
2. ボタンをクリックすると、近隣買主リストが展開される
3. 再度ボタンをクリックすると、近隣買主リストが折りたたまれる
4. 初期状態では折りたたまれている（非表示）
5. 近隣買主リストの内容は現在と同じ（NearbyBuyersListコンポーネントを使用）

### US-2: 実績の表示/非表示切り替え
**As a** 営業担当者  
**I want to** 通話モードページで「実績」ボタンをクリックして実績情報を表示/非表示できる  
**So that** 必要な時だけ実績データを確認でき、画面をすっきり保てる

**受け入れ基準**:
1. 通話モードページの「実績」セクションが`CollapsibleSection`コンポーネントでラップされる
2. ボタンをクリックすると、実績セクションが展開される
3. 再度ボタンをクリックすると、実績セクションが折りたたまれる
4. 初期状態では折りたたまれている（非表示）
5. 実績の内容は現在と同じ（PerformanceMetricsSectionコンポーネントを使用）

## 技術要件

### 1. 既存コンポーネントの再利用
- `NearbyBuyersList`コンポーネント（frontend/src/components/NearbyBuyersList.tsx）を使用（既存）
- `PerformanceMetricsSection`コンポーネント（frontend/src/components/PerformanceMetricsSection.tsx）を使用（既存）
- `CollapsibleSection`コンポーネント（frontend/src/components/CollapsibleSection.tsx）を使用して折りたたみ機能を実装

### 2. 修正箇所
通話モードページ（CallModePage.tsx）の以下のセクションを修正：
- 「近隣買主リスト」セクション（行2901-2909付近）
- 「実績セクション」（行4988-4991付近）

### 3. 状態管理
- 各セクションの展開/折りたたみ状態は`CollapsibleSection`コンポーネント内で管理
- 初期状態は両方とも折りたたまれている（defaultExpanded={false}）

### 4. UIデザイン
- 既存の`CollapsibleSection`コンポーネントのスタイルに統一
- ボタンのラベル:
  - 「近隣買主リスト」
  - 「実績」
- アイコン: 展開時は▼、折りたたみ時は▶

## 非機能要件

### パフォーマンス
- 近隣買主リストと実績データは、セクションが展開された時のみ読み込む（遅延読み込み）
- 既存のページ読み込み速度に影響を与えない

### 互換性
- 既存の通話モードページの機能に影響を与えない
- 現在の「近隣買主リスト」と「実績」の表示内容・動作を維持

### アクセシビリティ
- キーボード操作でボタンをクリックできる
- スクリーンリーダーで読み上げ可能

## 制約事項

1. **システム隔離ルール**: 売主リスト（Seller Management）システムのみを変更する
2. **既存コンポーネントの再利用**: 新しいコンポーネントは作成せず、既存の`CollapsibleSection`コンポーネントを使用する
3. **表示内容の維持**: 現在の「近隣買主リスト」と「実績」の表示内容を変更しない

## 参考実装

### 現在の通話モードページの実装（CallModePage.tsx）

**近隣買主リスト（行2901-2909付近）**:
```typescript
{/* 近隣買主リスト */}
{seller?.id && (
  <Box sx={{ mb: 3 }}>
    <Typography variant="h6" sx={{ mb: 2 }}>
      🏘️ 近隣買主リスト
    </Typography>
    <NearbyBuyersList sellerId={seller.id} />
  </Box>
)}
```

**実績セクション（行4988-4991付近）**:
```typescript
{/* 実績セクション */}
<Box sx={{ mt: 3 }}>
  <PerformanceMetricsSection />
</Box>
```

### 修正後のイメージ

**近隣買主リスト**:
```typescript
{/* 近隣買主リスト */}
{seller?.id && (
  <CollapsibleSection title="近隣買主リスト" defaultExpanded={false}>
    <NearbyBuyersList sellerId={seller.id} />
  </CollapsibleSection>
)}
```

**実績セクション**:
```typescript
{/* 実績セクション */}
<CollapsibleSection title="実績" defaultExpanded={false}>
  <PerformanceMetricsSection />
</CollapsibleSection>
```

## 成功基準

1. 通話モードページの「近隣買主リスト」と「実績」がボタンで折りたたみ可能になる
2. ボタンをクリックすると、対応するセクションが展開/折りたたまれる
3. 近隣買主リストと実績の内容が現在と同じように表示される
4. 既存の通話モードページの機能に影響がない
5. ページの読み込み速度が遅くならない

## 除外事項

- 近隣買主リストと実績の表示内容の変更（既存のコンポーネントをそのまま使用）
- 新しいAPIエンドポイントの追加（既存のAPIを使用）
- 売主詳細ページの変更

## リスク

1. **パフォーマンスリスク**: 近隣買主リストと実績データの読み込みが遅い場合、ページ全体の読み込みが遅くなる可能性
   - 対策: セクションが展開された時のみデータを読み込む（遅延読み込み）

2. **互換性リスク**: 既存のコンポーネントが売主詳細画面で正しく動作しない可能性
   - 対策: 通話モードページと同じpropsを渡す

## 次のステップ

1. 設計ドキュメント（design.md）の作成
2. タスクリスト（tasks.md）の作成
3. 実装
4. テスト
5. デプロイ
