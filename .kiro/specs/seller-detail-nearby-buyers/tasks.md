# タスクリスト

## Phase 1: バックエンド実装

### 1. エリアマップサービスの作成
- [x] 1.1 既存の`PropertyDistributionAreaCalculator`サービスを使用
  - 物件住所から配信エリアを計算
  - エリア番号のリストを取得

### 2. 買主サービスのメソッド追加
- [x] 2.1 `backend/src/services/BuyerService.ts`に`getBuyersByAreas`メソッドを追加
  - 該当エリア番号の買主を取得
  - `distribution_areas`カラム（JSONB型）に該当エリア番号が含まれる買主を検索

### 3. 売主APIエンドポイントの追加
- [x] 3.1 `backend/src/routes/sellers.ts`に`GET /api/sellers/:id/nearby-buyers`エンドポイントを追加
  - 売主の物件住所から`PropertyDistributionAreaCalculator`を使用してエリア番号を取得
  - 該当エリアの買主を取得
  - 買主リストを返す

## Phase 2: フロントエンド実装

### 4. 近隣買主リストコンポーネントの作成
- [x] 4.1 `frontend/src/components/NearbyBuyersList.tsx`を作成
  - 買主リストをテーブル形式で表示
  - 買主番号、氏名、電話番号、希望エリア、最新状況、内覧日を表示
  - 買主番号をクリックすると買主詳細ページに遷移
  - ローディング状態とエラー表示

### 5. 売主詳細画面への統合
- [x] 5.1 `frontend/src/pages/CallModePage.tsx`に近隣買主リストセクションを追加
  - 物件情報セクションの下に配置
  - `NearbyBuyersList`コンポーネントを使用

## Phase 3: テストと調整

### 6. 動作確認
- [x] 6.1 物件住所から配信エリアが正しく計算されることを確認
- [x] 6.2 該当エリアの買主が正しく取得されることを確認
- [x] 6.3 BuyerCandidateServiceと同じフィルタリング条件を適用
- [x] 6.4 大分市の住所ベースエリアマッピングを実装
  - ①エリア（大道町周辺）: 36地域（中央町、金池町、荷揚町、城崎町を追加）
  - ②エリア: 48地域（萩原、新貝、高城、高松、花高松、原川、日岡、松原町、向原、岡、千歳、三川、桃園団地、山津、小池原等）
  - ③エリア: 19地域（久保山団地、横尾、猪野、葛木、森、法勝台、公園通り、京が丘、大津留、毛井、松岡、下郡、明野高尾等）
  - ④エリア: 32地域（鶴崎コスモス団地、森、金谷、下徳丸、関園、常行、南関、門迫、堂園、鶴瀬、丸亀、亀甲、上徳丸、南つるさき、陽光台、宮河内ハイランド、リバーサイド、若葉台、迫、種具、広内、宮河内、杵河内、阿蘇、入新田、浄土寺、宮谷、別保等）
  - ⑥エリア: 21地域（賀来北、賀来西、賀来南、国分新町、国分台、国分団地、東野台、大字賀来、大字国分、大字東院、大字中尾、カームタウン、野田、中尾、森ノ木、脇、大字野田、宮苑、大字平横瀬、大字宮苑、餅田等）
  - ⑦エリア: 35地域（ふじが丘、富士見が丘、田尻、光吉、大字今市、石合、一本櫟、今市町、上石合、白家、摺練ケ迫、山中、大字入蔵、吉熊、日方、羽原、大字太田、太田、田ノ口、原村、大字上詰、湛水、大字沢田、沢田、大字下原、大字高原、大字竹矢、大字辻原、大字荷尾杵、大字野津原、大字福宗、大字廻栖野、敷戸、古国府等）
  - ⑧エリア: 7地域（戸次、中判田、大字安藤、大字河原内、大字竹中、大字端登、鴛野）
  - **合計198地域を実装完了**
- [x] 6.5 AA13530（萩原）が②,㊵エリアにマッピングされることを確認
- [x] 6.6 全てのエリアマッピングが正しく動作することをテストで確認（86/86テスト成功）
- [x] 6.7 近隣買主リストのソート機能を実装
  - 受付日（reception_date）の降順（新しい順）
  - 確度（inquiry_confidence）の降順（A > B > C > D）
  - AA13530で238件の買主が正しくソートされることを確認
  - **ソートロジックの修正**: 2026年の日付が2025年より先に表示されるように修正（dateA - dateB > 0 ? -1 : 1）
  - 単体テストで検証完了（2026 > 2025 > 2024 > null）
- [ ] 6.8 売主詳細画面に近隣買主リストが表示されることを確認
- [ ] 6.9 買主番号をクリックすると買主詳細ページに遷移できることを確認
- [ ] 6.10 該当する買主がいない場合は「該当する買主はいません」と表示されることを確認
