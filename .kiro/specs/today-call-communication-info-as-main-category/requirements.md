# 「当日TEL（内容）」を独立した本カテゴリに変更

## 概要

現在、サイドバーに「④当日TEL（内容）」という親カテゴリがあり、その下に「当日TEL(夕方)」「当日TEL(メール を優先して希望)」などのサブカテゴリが表示されています。

この仕様を変更し、「④当日TEL（内容）」という親カテゴリを削除して、各コミュニケーション情報を独立した本カテゴリとして表示します。

---

## 現在の仕様（変更前）

### サイドバー表示

```
①訪問予定(Y) [5]
②訪問済み(I) [3]
③当日TEL分 [10]
当日TEL(Y) [2]
当日TEL(I) [3]
④当日TEL（内容） [4]  ← 親カテゴリ（削除する）
  ├─ 当日TEL(夕方) [1]
  ├─ 当日TEL(メール を優先して希望) [2]
  └─ 当日TEL(午前中) [1]
⑤未査定 [5]
⑥査定（郵送） [2]
⑦当日TEL_未着手 [3]
⑧Pinrich空欄 [4]
```

### 問題点

- 「④当日TEL（内容）」という親カテゴリが不要
- サブカテゴリとして表示されているため、階層が深くなっている
- 各コミュニケーション情報を直接クリックできるようにしたい

---

## 新しい仕様（変更後）

### サイドバー表示

```
①訪問予定(Y) [5]
②訪問済み(I) [3]
③当日TEL分 [10]
当日TEL(Y) [2]
当日TEL(I) [3]
当日TEL(夕方) [1]        ← 独立した本カテゴリ
当日TEL(メール を優先して希望) [2]  ← 独立した本カテゴリ
当日TEL(午前中) [1]      ← 独立した本カテゴリ
⑤未査定 [5]
⑥査定（郵送） [2]
⑦当日TEL_未着手 [3]
⑧Pinrich空欄 [4]
```

### 変更内容

1. **「④当日TEL（内容）」親カテゴリを削除**
2. **各コミュニケーション情報を独立した本カテゴリとして表示**
   - 「当日TEL(夕方)」
   - 「当日TEL(メール を優先して希望)」
   - 「当日TEL(午前中)」
   - など（今後、括弧内には様々な値が入る可能性がある）

3. **表示順序**
   - 「当日TEL（担当）」カテゴリの後に表示
   - 件数の多い順にソート

**重要なルール**: 
- 「当日TEL(○○)」の括弧内の値は動的に決まる
- どのような値が入っても、全て独立した本カテゴリとして扱う
- 親カテゴリでグループ化しない

---

## ユーザーストーリー

### US-1: コミュニケーション情報別カテゴリの表示

**As a** 営業担当者  
**I want to** サイドバーで各コミュニケーション情報を独立したカテゴリとして表示したい  
**So that** 特定のコミュニケーション方法の売主を素早く確認できる

**受け入れ基準**:
- [ ] サイドバーに「当日TEL(夕方)」「当日TEL(メール を優先して希望)」などが独立したカテゴリとして表示される
- [ ] 「④当日TEL（内容）」という親カテゴリは表示されない
- [ ] 各カテゴリには件数が表示される
- [ ] 件数の多い順にソートされる

---

### US-2: コミュニケーション情報別カテゴリのフィルタリング

**As a** 営業担当者  
**I want to** 各コミュニケーション情報カテゴリをクリックして売主一覧をフィルタリングしたい  
**So that** 特定のコミュニケーション方法の売主のみを表示できる

**受け入れ基準**:
- [ ] 「当日TEL(夕方)」をクリックすると、連絡方法が「夕方」の売主のみが一覧に表示される
- [ ] 「当日TEL(メール を優先して希望)」をクリックすると、連絡方法が「メール を優先して希望」の売主のみが一覧に表示される
- [ ] フィルタリング後、URLパラメータに状態が反映される
- [ ] ページをリロードしても、フィルタリング状態が保持される

---

### US-3: 通話モードページでの動作

**As a** 営業担当者  
**I want to** 通話モードページでも同じようにコミュニケーション情報別カテゴリを表示・フィルタリングしたい  
**So that** 通話モードでも特定のコミュニケーション方法の売主を素早く確認できる

**受け入れ基準**:
- [ ] 通話モードページのサイドバーにも同じカテゴリが表示される
- [ ] カテゴリをクリックすると、売主一覧がフィルタリングされる
- [ ] フィルタリング後、URLパラメータに状態が反映される

---

## 技術的な詳細

### カテゴリの条件

各コミュニケーション情報カテゴリの条件：

**基本条件**（全てのカテゴリ共通）:
- 状況（当社）に「追客中」が含まれる
- 次電日が今日以前
- 営担（visitAssignee）が空

**個別条件**:
- 「当日TEL(夕方)」: `contact_method = "夕方"` または `preferred_contact_time = "夕方"` または `phone_contact_person = "夕方"`
- 「当日TEL(メール を優先して希望)」: `contact_method = "メール を優先して希望"`
- 「当日TEL(午前中)」: `preferred_contact_time = "午前中"`
- など

### ラベルの優先順位

1. `contact_method`（連絡方法）
2. `preferred_contact_time`（連絡取りやすい時間）
3. `phone_contact_person`（電話担当）

---

## 非機能要件

### パフォーマンス

- [ ] サイドバーのカテゴリ表示は1秒以内に完了する
- [ ] フィルタリングは即座に反映される（500ms以内）

### 互換性

- [ ] 既存の「当日TEL（担当）」カテゴリには影響しない
- [ ] 既存の「当日TEL分」カテゴリには影響しない

---

## 制約事項

- 「④当日TEL（内容）」という親カテゴリは完全に削除する
- 各コミュニケーション情報カテゴリは独立したカテゴリとして扱う
- 番号は振らない（「④」などの番号は削除）

---

## 成功基準

- [ ] サイドバーに「④当日TEL（内容）」が表示されない
- [ ] 各コミュニケーション情報が独立したカテゴリとして表示される
- [ ] カテゴリをクリックすると、正しくフィルタリングされる
- [ ] 通話モードページでも同じように動作する
- [ ] URLパラメータで状態が保持される

---

## 参考資料

- `.kiro/steering/sidebar-status-definition.md` - サイドバーステータス定義
- `.kiro/specs/today-call-with-info-subcategory-filtering/` - 既存のサブカテゴリフィルタリング機能
