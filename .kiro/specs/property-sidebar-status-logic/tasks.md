# 物件リスト：サイドバーカテゴリー ステータス判定仕様 - タスクリスト

## 1. データベース準備
- [x] 1.1 `property_listings`テーブルに`sidebar_status`カラムを追加
- [x] 1.2 `sidebar_status`カラムにインデックスを作成

## 2. バックエンド実装
- [x] 2.1 `PropertyListingSyncService`に`calculateSidebarStatus()`メソッドを追加
  - [x] 2.1.1 ① 未報告（最優先）の判定ロジック
  - [x] 2.1.2 ② 未完了の判定ロジック
  - [x] 2.1.3 ③ 非公開予定（確認後）の判定ロジック
  - [x] 2.1.4 ④ 一般媒介の掲載確認未の判定ロジック
  - [x] 2.1.5 ⑤ 本日公開予定の判定ロジック
  - [x] 2.1.6 ⑥ SUUMO / レインズ登録必要の判定ロジック
  - [x] 2.1.7 ⑦ 買付申込み（内覧なし）２の判定ロジック
  - [x] 2.1.8 ⑧ 公開前情報の判定ロジック
  - [x] 2.1.9 ⑨ 非公開（配信メールのみ）の判定ロジック
  - [x] 2.1.10 ⑩ 一般公開中物件の判定ロジック
  - [x] 2.1.11 ⑪ 専任・公開中（担当別）の判定ロジック
  - [x] 2.1.12 ⑫ それ以外の判定ロジック
- [x] 2.2 ヘルパーメソッドを追加
  - [x] 2.2.1 `lookupGyomuList()` - 業務依頼シートからデータ検索
  - [x] 2.2.2 `isDateBeforeOrToday()` - 日付が今日以前かチェック
  - [x] 2.2.3 `isDateBeforeYesterday()` - 日付が昨日以前かチェック
  - [x] 2.2.4 `parseDate()` - 日付をパース（シリアル値対応）
  - [x] 2.2.5 `getAssigneeStatus()` - 担当者名から専任公開中ステータスを取得
  - [x] 2.2.6 `loadStaffMapping()` - 担当者マッピングを読み込み
- [x] 2.3 `runFullSync()`メソッドを修正
  - [x] 2.3.1 業務依頼シートを1回だけ読み取る処理を追加
  - [x] 2.3.2 各物件の処理時に`calculateSidebarStatus()`を呼び出す
  - [x] 2.3.3 `sidebar_status`をpropertyDataに追加
- [ ] 2.4 設定ファイルを作成（オプション）
  - [x] 2.4.1 `backend/api/config/staff-mapping.json`を作成

## 3. フロントエンド実装
- [x] 3.1 `PropertySidebarStatus`コンポーネントを作成
  - [x] 3.1.1 ステータスごとにグループ化するロジック
  - [x] 3.1.2 ステータスを優先順位順にソート
  - [x] 3.1.3 クリックでフィルタリングする機能
- [x] 3.2 物件リスト画面を修正
  - [x] 3.2.1 `PropertySidebarStatus`コンポーネントを配置
  - [x] 3.2.2 選択されたステータスで物件をフィルタリング
  - [x] 3.2.3 既存のサイドバーフィルターを削除
- [ ] 3.3 スタイリングを追加
  - [ ] 3.3.1 `PropertySidebarStatus.css`を作成
  - [ ] 3.3.2 アクティブ状態のスタイル
  - [ ] 3.3.3 ホバー状態のスタイル

## 4. テスト
- [x] 4.1 バックエンド単体テスト
  - [x] 4.1.1 ① 未報告のテスト
  - [x] 4.1.2 ② 未完了のテスト
  - [x] 4.1.3 ⑪ 専任・公開中（担当別）のテスト
  - [x] 4.1.4 ⑫ それ以外のテスト
- [ ] 4.2 統合テスト
  - [ ] 4.2.1 同期後にsidebar_statusが保存されることを確認
- [ ] 4.3 フロントエンドテスト
  - [ ] 4.3.1 ステータスごとにグループ化されることを確認
  - [ ] 4.3.2 クリックでフィルタリングされることを確認

## 5. デプロイ
- [x] 5.1 データベースマイグレーションを実行
- [x] 5.2 バックエンドをデプロイ
- [x] 5.3 フロントエンドをデプロイ
- [x] 5.4 動作確認
  - [ ] 5.4.1 同期ログを確認
  - [ ] 5.4.2 DBのsidebar_statusを確認
  - [ ] 5.4.3 フロントエンドでステータスカテゴリーが表示されることを確認
  - [ ] 5.4.4 フィルタリングが動作することを確認
