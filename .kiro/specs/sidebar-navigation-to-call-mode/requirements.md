# サイドバーから通話モードページへの遷移機能

## 概要

売主リストの通話モードページのサイドバーで、各ステータスカテゴリの項目（売主）をクリックした際に、その売主の通話モードページに直接遷移できるようにする機能を実装します。

---

## 背景

### 現在の動作

**売主リストページ**:
- サイドバーのカテゴリをクリック → メインテーブルがフィルタリングされる ✅

**通話モードページ**:
- サイドバーのカテゴリをクリック → **何も起こらない** ❌
- カテゴリは展開されない
- 売主の通話モードページに遷移しない

### 問題点

**通話モードページでサイドバーのボタンを押しても無反応**

コードを確認したところ、`handleCategoryClick`関数で以下のように実装されています：

```typescript
const handleCategoryClick = (category: StatusCategory) => {
  if (expandedCategory === category) {
    setExpandedCategory(null);
  } else {
    setExpandedCategory(category);
  }
  
  // 売主リストページの場合のみカテゴリを選択
  if (!isCallMode) {
    onCategorySelect?.(category);
  }
  // ← 通話モードページの場合は何もしない
};
```

**問題**: `isCallMode = true`の場合、カテゴリを展開するだけで、その後の処理がない

### ユーザーの要望

「通話モードページでサイドバーをクリックしたら、その項目の通話モードページに移動してほしい」

---

## ユーザーストーリー

### US-1: サイドバーのカテゴリから売主の通話モードページに遷移

**As a** 営業担当者  
**I want to** 通話モードページのサイドバーで、各ステータスカテゴリをクリックして、そのカテゴリの最初の売主の通話モードページに直接遷移したい  
**So that** 効率的に売主の通話対応を行える

**受け入れ基準**:
1. 通話モードページのサイドバーで、カテゴリをクリックすると、そのカテゴリの最初の売主の通話モードページに遷移する
2. カテゴリに該当する売主がいない場合は、エラーメッセージを表示する
3. 遷移後、サイドバーの新しい売主のカテゴリがハイライトされる
4. 売主リストページの動作は変更しない（メインテーブルのフィルタリング）

---

### US-2: 訪問予定/訪問済みカテゴリから売主の通話モードページに遷移

**As a** 営業担当者  
**I want to** 通話モードページのサイドバーで、訪問予定/訪問済みのイニシャル別ボタンをクリックして、そのイニシャルの最初の売主の通話モードページに遷移したい  
**So that** 訪問予定/訪問済みの売主に効率的に対応できる

**受け入れ基準**:
1. 訪問予定/訪問済みのイニシャル別ボタンをクリックすると、そのイニシャルの最初の売主の通話モードページに遷移する
2. イニシャルに該当する売主がいない場合は、エラーメッセージを表示する
3. 遷移後、サイドバーの新しい売主のカテゴリとイニシャルがハイライトされる
4. 売主リストページの動作は変更しない（メインテーブルのフィルタリング）

---

### US-3: 当日TEL（内容）カテゴリから売主の通話モードページに遷移

**As a** 営業担当者  
**I want to** 通話モードページのサイドバーで、当日TEL（内容）のグループ別ボタンをクリックして、そのグループの最初の売主の通話モードページに遷移したい  
**So that** コミュニケーション情報別に売主に効率的に対応できる

**受け入れ基準**:
1. 当日TEL（内容）のグループ別ボタンをクリックすると、そのグループの最初の売主の通話モードページに遷移する
2. グループに該当する売主がいない場合は、エラーメッセージを表示する
3. 遷移後、サイドバーの新しい売主のカテゴリとグループがハイライトされる
4. 売主リストページの動作は変更しない（メインテーブルのフィルタリング）

---

## 機能要件

### FR-1: サイドバーのカテゴリクリック時の動作

**通話モードページ**:
- カテゴリをクリック → そのカテゴリの最初の売主の通話モードページに遷移する
- 該当する売主がいない場合 → エラーメッセージを表示

**売主リストページ**:
- カテゴリをクリック → メインテーブルがフィルタリングされる（現在の動作を維持）

---

### FR-2: 訪問予定/訪問済みのイニシャル別ボタンクリック時の動作

**通話モードページ**:
- イニシャル別ボタンをクリック → そのイニシャルの最初の売主の通話モードページに遷移する
- 該当する売主がいない場合 → エラーメッセージを表示

**売主リストページ**:
- イニシャル別ボタンをクリック → メインテーブルがフィルタリングされる（現在の動作を維持）

---

### FR-3: 当日TEL（内容）のグループ別ボタンクリック時の動作

**通話モードページ**:
- グループ別ボタンをクリック → そのグループの最初の売主の通話モードページに遷移する
- 該当する売主がいない場合 → エラーメッセージを表示

**売主リストページ**:
- グループ別ボタンをクリック → メインテーブルがフィルタリングされる（現在の動作を維持）

---

### FR-4: ハイライト表示

**通話モードページ**:
- 現在の売主が属するカテゴリがハイライトされる
- 訪問予定/訪問済みの場合、イニシャルもハイライトされる
- 当日TEL（内容）の場合、グループもハイライトされる

---

### FR-5: 売主リストの取得

**通話モードページ**:
- サイドバーに表示する売主リストは、propsの`sellers`から取得する
- カテゴリごとに売主リストをフィルタリングする
- 最初の売主を取得して通話モードページに遷移する

---

## 非機能要件

### NFR-1: パフォーマンス

- サイドバーのボタンクリックから通話モードページへの遷移は1秒以内に完了する

### NFR-2: ユーザビリティ

- サイドバーの操作は直感的で分かりやすい
- 現在の売主がどのカテゴリに属するかが一目で分かる
- ボタンをクリックすると即座に遷移する（展開の必要なし）

### NFR-3: 保守性

- コードは既存の実装を最大限活用する
- 新しい機能は既存のコードに影響を与えない

---

## 技術的制約

### TC-1: 既存の実装を活用

- `SellerStatusSidebar.tsx`の既存の実装を最大限活用する
- `handleSellerClick`関数は既に実装されている
- `filterSellersByCategory`関数は既に実装されている
- `getVisitDataByAssignee`関数は既に実装されている

### TC-2: 売主リストの取得

- 売主リストは`sellers` propsから取得する
- カテゴリごとにフィルタリングする必要がある
- 最初の売主を取得して通話モードページに遷移する

---

## 実装の優先順位

### P0（最優先）

- US-1: サイドバーのカテゴリから最初の売主の通話モードページに遷移

### P1（高優先度）

- US-2: 訪問予定/訪問済みカテゴリから最初の売主の通話モードページに遷移
- US-3: 当日TEL（内容）カテゴリから最初の売主の通話モードページに遷移

---

## 成功基準

1. 通話モードページのサイドバーで、カテゴリをクリックすると、そのカテゴリの最初の売主の通話モードページに遷移する
2. 訪問予定/訪問済みのイニシャル別ボタンをクリックすると、そのイニシャルの最初の売主の通話モードページに遷移する
3. 当日TEL（内容）のグループ別ボタンをクリックすると、そのグループの最初の売主の通話モードページに遷移する
4. 該当する売主がいない場合は、エラーメッセージが表示される
5. 遷移後、新しい売主のカテゴリがハイライトされる
6. パフォーマンスは1秒以内
7. 売主リストページの動作は変更されない

---

## 除外事項

- 売主リストページのサイドバーの動作は変更しない（現在の動作を維持）
- サイドバーのデザインは変更しない
- 新しいカテゴリの追加は行わない
- カテゴリの展開機能は削除する（通話モードページでは不要）

---

## リスク

### R-1: パフォーマンス

**リスク**: 売主リストが多い場合、サイドバーの展開が遅くなる可能性がある

**対策**: 
- 売主リストは最大100件まで表示する
- ページネーションを実装する（将来的に）

### R-2: 既存機能への影響

**リスク**: 既存のサイドバーの動作に影響を与える可能性がある

**対策**:
- 売主リストページの動作は変更しない
- 通話モードページのみ新しい動作を実装する

---

## 関連ドキュメント

- `.kiro/steering/sidebar-status-definition.md` - サイドバーステータス定義
- `frontend/src/components/SellerStatusSidebar.tsx` - サイドバーコンポーネント
- `frontend/src/utils/sellerStatusFilters.ts` - ステータスフィルタリングロジック

---

**作成日**: 2026年2月2日  
**作成者**: Kiro AI  
**ステータス**: レビュー待ち
