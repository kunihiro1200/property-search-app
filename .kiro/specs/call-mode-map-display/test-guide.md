# 通話モードページ地図表示機能 - テストガイド

## テスト環境の準備

### 1. バックエンドサーバーの起動

```bash
cd backend
npm run dev
```

### 2. フロントエンドサーバーの起動

```bash
cd frontend
npm run dev
```

### 3. Google Maps APIキーの確認

`.env.local`ファイルに以下の環境変数が設定されていることを確認：

```
VITE_GOOGLE_MAPS_API_KEY=your_api_key_here
```

---

## Phase 5.1: 正常系テスト

### テスト1: 物件住所が設定されている売主で地図が表示される

**手順**:
1. 通話モードページを開く（物件住所が設定されている売主を選択）
2. 物件情報セクションの下に地図セクションが表示されることを確認
3. 地図が正しく読み込まれることを確認（3秒以内）
4. 地図上にピンが表示されることを確認

**期待される結果**:
- ✅ 地図セクションが物件情報と売主情報の間に表示される
- ✅ 地図が正しく読み込まれる
- ✅ 地図上にピンが正しい位置に表示される
- ✅ ローディングインジケーターが表示され、読み込み完了後に消える

**テスト用売主番号**:
- AA13501（物件住所あり）
- AA13507（物件住所あり）
- AA13508（物件住所あり）

---

### テスト2: 地図上にピンが正しい位置に表示される

**手順**:
1. 通話モードページを開く（物件住所が設定されている売主を選択）
2. 地図上のピンの位置を確認
3. 物件住所とピンの位置が一致することを確認

**期待される結果**:
- ✅ ピンが物件住所の位置に正しく表示される
- ✅ ピンの色が赤色（#FF0000）である
- ✅ ピンをクリックすると情報ウィンドウが表示される（物件住所）

---

### テスト3: 地図のズーム操作が正常に動作する

**手順**:
1. 通話モードページを開く（物件住所が設定されている売主を選択）
2. 地図上でマウスホイールを使用してズームイン/ズームアウト
3. 地図の右下にある「+」「-」ボタンでズームイン/ズームアウト

**期待される結果**:
- ✅ マウスホイールでズームイン/ズームアウトができる
- ✅ 「+」「-」ボタンでズームイン/ズームアウトができる
- ✅ ズーム操作がスムーズに動作する

---

### テスト4: 地図のドラッグ操作が正常に動作する

**手順**:
1. 通話モードページを開く（物件住所が設定されている売主を選択）
2. 地図上でマウスをドラッグして地図を移動
3. 地図が移動することを確認

**期待される結果**:
- ✅ 地図をドラッグして移動できる
- ✅ ドラッグ操作がスムーズに動作する
- ✅ ピンの位置は変わらない

---

## Phase 5.2: 異常系テスト

### テスト5: 物件住所が未設定の売主で地図が表示されない

**手順**:
1. 通話モードページを開く（物件住所が未設定の売主を選択）
2. 地図セクションが表示されないことを確認

**期待される結果**:
- ✅ 地図セクションが表示されない
- ✅ エラーメッセージが表示されない
- ✅ 物件情報セクションと売主情報セクションの間に余白がない

**テスト用売主番号**:
- 物件住所が未設定の売主を選択

---

### テスト6: ジオコーディング失敗時に地図が表示されない

**手順**:
1. 通話モードページを開く（無効な物件住所が設定されている売主を選択）
2. 地図セクションが表示されないことを確認
3. コンソールログにエラーメッセージが表示されることを確認

**期待される結果**:
- ✅ 地図セクションが表示されない
- ✅ コンソールログに「Failed to geocode address」エラーが表示される
- ✅ ユーザーにはエラーメッセージが表示されない（静かに失敗）

**テスト方法**:
- 開発者ツールのコンソールを開いて確認

---

### テスト7: エラーメッセージが表示されない

**手順**:
1. 通話モードページを開く（物件住所が未設定または無効な売主を選択）
2. 画面上にエラーメッセージが表示されないことを確認

**期待される結果**:
- ✅ 画面上にエラーメッセージが表示されない
- ✅ 地図セクションが静かに非表示になる
- ✅ 他のセクションは正常に表示される

---

## Phase 5.3: パフォーマンステスト

### テスト8: 地図の読み込みが3秒以内に完了する

**手順**:
1. 通話モードページを開く（物件住所が設定されている売主を選択）
2. 地図の読み込み時間を計測
3. 3秒以内に地図が表示されることを確認

**期待される結果**:
- ✅ 地図の読み込みが3秒以内に完了する
- ✅ ローディングインジケーターが表示される
- ✅ 読み込み完了後、ローディングインジケーターが消える

**計測方法**:
- 開発者ツールのNetworkタブで計測
- または、ストップウォッチで手動計測

---

### テスト9: 地図の読み込み中も他のセクションが正常に表示される

**手順**:
1. 通話モードページを開く（物件住所が設定されている売主を選択）
2. 地図の読み込み中に他のセクション（物件情報、売主情報）が表示されることを確認
3. 地図の読み込みが完了するまで他のセクションが操作可能であることを確認

**期待される結果**:
- ✅ 地図の読み込み中も物件情報セクションが表示される
- ✅ 地図の読み込み中も売主情報セクションが表示される
- ✅ 地図の読み込み中も他のセクションが操作可能

---

## Phase 5.4: レスポンシブデザインテスト

### テスト10: デスクトップ表示

**手順**:
1. ブラウザのウィンドウサイズを1920x1080に設定
2. 通話モードページを開く（物件住所が設定されている売主を選択）
3. 地図が正しく表示されることを確認

**期待される結果**:
- ✅ 地図が画面幅いっぱいに表示される
- ✅ 地図の高さが400pxである
- ✅ レイアウトが崩れていない

---

### テスト11: タブレット表示

**手順**:
1. ブラウザのウィンドウサイズを768x1024に設定
2. 通話モードページを開く（物件住所が設定されている売主を選択）
3. 地図が正しく表示されることを確認

**期待される結果**:
- ✅ 地図が画面幅いっぱいに表示される
- ✅ 地図の高さが400pxである
- ✅ レイアウトが崩れていない

---

### テスト12: モバイル表示

**手順**:
1. ブラウザのウィンドウサイズを375x667に設定
2. 通話モードページを開く（物件住所が設定されている売主を選択）
3. 地図が正しく表示されることを確認

**期待される結果**:
- ✅ 地図が画面幅いっぱいに表示される
- ✅ 地図の高さが400pxである
- ✅ レイアウトが崩れていない

---

## Phase 5.5: 既存機能への影響確認

### テスト13: 通話モードページの既存機能が全て正常に動作する

**手順**:
1. 通話モードページを開く
2. 以下の既存機能が正常に動作することを確認：
   - 物件情報の編集
   - 売主情報の編集
   - コメントの編集
   - 通話ログの表示
   - フォローアップログの表示
   - パフォーマンスメトリクスの表示
   - クイックボタンの動作

**期待される結果**:
- ✅ 全ての既存機能が正常に動作する
- ✅ 地図の追加によって既存機能に影響がない

---

### テスト14: 公開物件サイトの地図機能が正常に動作する

**手順**:
1. 公開物件サイトを開く
2. 物件詳細ページを開く
3. 地図が正しく表示されることを確認

**期待される結果**:
- ✅ 公開物件サイトの地図が正常に表示される
- ✅ 通話モードページの地図追加によって影響がない

---

## テスト結果の記録

各テストの結果を以下の表に記録してください：

| テスト番号 | テスト名 | 結果 | 備考 |
|-----------|---------|------|------|
| 1 | 物件住所が設定されている売主で地図が表示される | ⬜ | |
| 2 | 地図上にピンが正しい位置に表示される | ⬜ | |
| 3 | 地図のズーム操作が正常に動作する | ⬜ | |
| 4 | 地図のドラッグ操作が正常に動作する | ⬜ | |
| 5 | 物件住所が未設定の売主で地図が表示されない | ⬜ | |
| 6 | ジオコーディング失敗時に地図が表示されない | ⬜ | |
| 7 | エラーメッセージが表示されない | ⬜ | |
| 8 | 地図の読み込みが3秒以内に完了する | ⬜ | |
| 9 | 地図の読み込み中も他のセクションが正常に表示される | ⬜ | |
| 10 | デスクトップ表示 | ⬜ | |
| 11 | タブレット表示 | ⬜ | |
| 12 | モバイル表示 | ⬜ | |
| 13 | 通話モードページの既存機能が全て正常に動作する | ⬜ | |
| 14 | 公開物件サイトの地図機能が正常に動作する | ⬜ | |

---

## トラブルシューティング

### 地図が表示されない

**原因1**: Google Maps APIキーが設定されていない

**解決策**:
1. `.env.local`ファイルを確認
2. `VITE_GOOGLE_MAPS_API_KEY`が設定されているか確認
3. 設定されていない場合は、APIキーを追加
4. フロントエンドサーバーを再起動

---

**原因2**: ジオコーディングAPIが失敗している

**解決策**:
1. 開発者ツールのコンソールを開く
2. エラーメッセージを確認
3. バックエンドサーバーのログを確認
4. Google Geocoding APIのクォータを確認

---

**原因3**: 物件住所が無効

**解決策**:
1. 物件住所が正しく設定されているか確認
2. 物件住所が日本の住所形式であるか確認
3. 物件住所に特殊文字が含まれていないか確認

---

**原因4**: `seller.propertyAddress`フィールドが存在しない

**解決策**:
1. ブラウザのコンソールログで`propInfo.address`の値を確認
2. `getPropertyInfo()`関数を使用して、`property.address`または`seller.propertyAddress`のフォールバックロジックを実装済み
3. フロントエンドサーバーを再起動（`cd frontend && npm run dev`）
4. ブラウザのハードリロード（Ctrl+Shift+R）を実行

---

**原因5**: フロントエンドサーバーが再起動されていない

**解決策**:
1. フロントエンドサーバーを停止（Ctrl+C）
2. フロントエンドサーバーを再起動（`cd frontend && npm run dev`）
3. ブラウザのハードリロード（Ctrl+Shift+R）を実行

---

**原因6**: ブラウザのキャッシュが残っている

**解決策**:
1. ブラウザのハードリロード（Ctrl+Shift+R）を実行
2. または、ブラウザのキャッシュをクリア
3. ブラウザを再起動

---

### 地図の読み込みが遅い

**原因**: ネットワークが遅い、またはGoogle Maps APIのレスポンスが遅い

**解決策**:
1. ネットワーク接続を確認
2. 開発者ツールのNetworkタブでリクエストを確認
3. タイムアウト設定を確認（現在5秒）

---

### ピンが正しい位置に表示されない

**原因**: ジオコーディングの結果が不正確

**解決策**:
1. 物件住所が正確であるか確認
2. Google Geocoding APIのレスポンスを確認
3. 必要に応じて、物件住所を修正

---

## 次のステップ

全てのテストが完了したら、以下のステップに進んでください：

1. Phase 6: ドキュメント更新
2. Phase 7: デプロイ準備

---

**作成日:** 2026年2月4日  
**作成者:** Kiro AI Assistant
