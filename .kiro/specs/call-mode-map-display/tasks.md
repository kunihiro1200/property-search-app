# 通話モードページ地図表示機能 - タスクリスト

## Phase 1: 準備と調査

- [x] 1.1 公開物件サイトの地図実装を確認
  - [x] 1.1.1 `PublicPropertyDetailPage.tsx`の地図表示ロジックを確認
  - [x] 1.1.2 `GoogleMapsContext`の使用方法を確認
  - [x] 1.1.3 座標取得方法を確認（ジオコーディングAPIの有無）

- [x] 1.2 既存のジオコーディングAPIを確認
  - [x] 1.2.1 バックエンドにジオコーディングAPIが存在するか確認
  - [x] 1.2.2 存在しない場合、新規作成の必要性を判断

## Phase 2: バックエンド実装（必要な場合のみ）

- [x] 2.1 ジオコーディングAPIエンドポイントを作成
  - [x] 2.1.1 `backend/src/routes/geocoding.ts`を作成
  - [x] 2.1.2 Google Geocoding APIを使用して住所から座標を取得
  - [x] 2.1.3 エラーハンドリングを実装
  - [x] 2.1.4 レート制限を考慮した実装

- [ ] 2.2 APIのテスト
  - [ ] 2.2.1 正常系のテスト（有効な住所）
  - [ ] 2.2.2 異常系のテスト（無効な住所）
  - [ ] 2.2.3 エラーハンドリングのテスト

## Phase 3: フロントエンド実装

- [x] 3.1 PropertyMapSectionコンポーネントを作成
  - [x] 3.1.1 `frontend/src/components/PropertyMapSection.tsx`を作成
  - [x] 3.1.2 基本的なコンポーネント構造を実装
  - [x] 3.1.3 Props型定義を追加

- [x] 3.2 地図表示ロジックを実装
  - [x] 3.2.1 `useGoogleMaps`フックをインポート
  - [x] 3.2.2 Google Maps APIの読み込み状態を管理
  - [x] 3.2.3 GoogleMapコンポーネントを配置
  - [x] 3.2.4 Markerコンポーネントを配置

- [x] 3.3 座標取得ロジックを実装
  - [x] 3.3.1 `useEffect`で`propertyAddress`の変更を監視
  - [x] 3.3.2 ジオコーディングAPIを呼び出す
  - [x] 3.3.3 座標をstateに保存
  - [x] 3.3.4 ローディング状態を管理

- [x] 3.4 エラーハンドリングを実装
  - [x] 3.4.1 ジオコーディング失敗時の処理
  - [x] 3.4.2 Google Maps API読み込み失敗時の処理
  - [x] 3.4.3 コンソールログの追加（デバッグ用）

- [x] 3.5 UIスタイルを実装
  - [x] 3.5.1 地図コンテナのスタイル設定（高さ400px）
  - [x] 3.5.2 Material-UI Paperコンポーネントでラップ
  - [x] 3.5.3 ローディングインジケーターを追加
  - [x] 3.5.4 レスポンシブデザインを実装

## Phase 4: CallModePageへの統合

- [x] 4.1 PropertyMapSectionをインポート
  - [x] 4.1.1 `CallModePage.tsx`に`PropertyMapSection`をインポート
  - [x] 4.1.2 必要な型定義をインポート

- [x] 4.2 地図セクションを配置
  - [x] 4.2.1 物件情報セクションの後に配置
  - [x] 4.2.2 売主情報セクションの前に配置
  - [x] 4.2.3 `propertyAddress`をpropsとして渡す

- [x] 4.3 既存コードとの整合性を確認
  - [x] 4.3.1 既存のレイアウトが崩れていないか確認
  - [x] 4.3.2 既存の機能が正常に動作するか確認

## Phase 5: テストと検証

- [x] 5.1 正常系テスト
  - [x] 5.1.1 物件住所が設定されている売主で地図が表示されることを確認
  - [x] 5.1.2 地図上にピンが正しい位置に表示されることを確認
  - [x] 5.1.3 地図のズーム操作が正常に動作することを確認
  - [x] 5.1.4 地図のドラッグ操作が正常に動作することを確認

- [x] 5.2 異常系テスト
  - [x] 5.2.1 物件住所が未設定の売主で地図が表示されないことを確認
  - [x] 5.2.2 ジオコーディング失敗時に地図が表示されないことを確認
  - [x] 5.2.3 エラーメッセージが表示されないことを確認

- [x] 5.3 パフォーマンステスト
  - [x] 5.3.1 地図の読み込みが3秒以内に完了することを確認
  - [x] 5.3.2 地図の読み込み中も他のセクションが正常に表示されることを確認

- [x] 5.4 レスポンシブデザインテスト
  - [x] 5.4.1 デスクトップ表示を確認
  - [x] 5.4.2 タブレット表示を確認
  - [x] 5.4.3 モバイル表示を確認

- [x] 5.5 既存機能への影響確認
  - [x] 5.5.1 通話モードページの既存機能が全て正常に動作することを確認
  - [x] 5.5.2 公開物件サイトの地図機能が正常に動作することを確認（影響なし）

## Phase 6: ドキュメント更新

- [x] 6.1 コードコメントを追加
  - [x] 6.1.1 `PropertyMapSection.tsx`にコメントを追加
  - [x] 6.1.2 `CallModePage.tsx`の変更箇所にコメントを追加

- [x] 6.2 README更新（必要な場合）
  - [x] 6.2.1 新機能の説明を追加
  - [x] 6.2.2 使用方法を記載

## Phase 7: デプロイ準備

- [x] 7.1 環境変数の確認
  - [x] 7.1.1 Google Maps APIキーが設定されていることを確認
  - [x] 7.1.2 本番環境の環境変数を確認

- [x] 7.2 最終確認
  - [x] 7.2.1 ローカル環境で全機能が正常に動作することを確認
  - [x] 7.2.2 コンソールエラーがないことを確認
  - [x] 7.2.3 パフォーマンスに問題がないことを確認

---

**作成日:** 2026年2月4日  
**作成者:** Kiro AI Assistant  
**ステータス:** 未着手
