---
inclusion: auto
---

# 物件リスト開発時のデプロイルール（絶対に守るべきルール）

## ⚠️ 最重要：公開物件サイトを壊さない

**絶対に守るべき原則**:
- **物件リスト（管理画面）の開発時に、公開物件サイトを絶対に触らない**
- **公開物件サイトは一般公開されており、壊すと大問題になる**
- **デプロイ先を間違えると、公開物件サイトが404エラーになる**

---

## 📋 3つの独立したシステム

### 1. 物件リスト（管理画面）
**用途**: 社内向けの物件管理画面

**フロントエンド**:
- `frontend/` ディレクトリ
- Vercelプロジェクト: `property-site-frontend`（管理画面用）
- デプロイコマンド: `cd frontend && vercel --prod`

**バックエンド**:
- `backend/src/` ディレクトリ
- `backend/api/src/services/PropertyListingSyncService.ts`（管理画面用）
- Vercelプロジェクト: `backend`
- デプロイコマンド: `cd backend && vercel --prod`

---

### 2. 公開物件サイト
**用途**: 一般公開用の物件検索サイト

**フロントエンド**:
- ルートディレクトリ（`index.html`, `app.js`, `styles.css`など）
- Vercelプロジェクト: `property-site-frontend`（公開サイト用）
- URL: `https://property-site-frontend-kappa.vercel.app/public/properties`
- デプロイコマンド: `vercel --prod`（ルートディレクトリから）

**バックエンド**:
- `backend/api/` ディレクトリ
- Vercelプロジェクト: `baikyaku-property-site3`
- デプロイコマンド: `cd backend && vercel --prod`

---

### 3. 買主リスト（管理画面）
**用途**: 社内向けの買主管理画面

**フロントエンド**:
- `frontend/` ディレクトリ（物件リストと共有）

**バックエンド**:
- `backend/src/` ディレクトリ（物件リストと共有）

---

## 🚨 絶対にやってはいけないこと

### ❌ 禁止事項1: frontendディレクトリをルートのVercelプロジェクトにデプロイ

```bash
# ❌ 間違い: frontendディレクトリをルートのVercelプロジェクトにデプロイ
cd frontend
vercel --prod  # これは管理画面用のプロジェクトにデプロイされる
```

**影響**:
- 公開物件サイトが404エラーになる
- 一般ユーザーがアクセスできなくなる
- 大問題になる

**正しい方法**:
```bash
# ✅ 正しい: frontendディレクトリは管理画面用のプロジェクトにのみデプロイ
# （通常は自動デプロイされるので手動デプロイ不要）
```

---

### ❌ 禁止事項2: backend/apiを物件リスト開発時に修正

```typescript
// ❌ 間違い: backend/api/src/services/PropertyListingSyncService.ts を修正
// このファイルは公開物件サイト用です
```

**影響**:
- 公開物件サイトのデータ同期が壊れる
- 公開物件サイトに表示される物件データが不正確になる

**正しい方法**:
```typescript
// ✅ 正しい: 物件リスト用のファイルのみを修正
// backend/src/services/ 配下のファイルを修正する
```

---

### ❌ 禁止事項3: ルートディレクトリのファイルを修正

```bash
# ❌ 間違い: ルートディレクトリのindex.html, app.js, styles.cssを修正
# これらは公開物件サイト用です
```

**影響**:
- 公開物件サイトのUIが壊れる
- 一般ユーザーに影響が出る

---

## ✅ 正しい開発フロー

### 物件リスト（管理画面）の開発時

1. **修正対象ファイル**:
   - `frontend/src/` 配下のファイル
   - `backend/src/` 配下のファイル
   - `backend/api/src/services/PropertyListingSyncService.ts`（管理画面用）

2. **デプロイ**:
   ```bash
   # フロントエンド（通常は自動デプロイ）
   cd frontend
   vercel --prod
   
   # バックエンド（必要な場合のみ）
   cd backend
   vercel --prod
   ```

3. **確認**:
   - 管理画面が正常に動作することを確認
   - 公開物件サイトが影響を受けていないことを確認

---

### 公開物件サイトの開発時

1. **修正対象ファイル**:
   - ルートディレクトリの`index.html`, `app.js`, `styles.css`など
   - `backend/api/` 配下のファイル

2. **デプロイ**:
   ```bash
   # フロントエンド
   vercel --prod  # ルートディレクトリから
   
   # バックエンド
   cd backend
   vercel --prod
   ```

3. **確認**:
   - 公開物件サイトが正常に動作することを確認
   - 管理画面が影響を受けていないことを確認

---

## 🔍 デプロイ前のチェックリスト

### 物件リスト開発時

- [ ] 修正したファイルは`frontend/src/`または`backend/src/`配下か？
- [ ] `backend/api/`配下のファイルを修正していないか？
- [ ] ルートディレクトリのファイルを修正していないか？
- [ ] デプロイ先は管理画面用のプロジェクトか？
- [ ] 公開物件サイトに影響がないか確認したか？

### 公開物件サイト開発時

- [ ] 修正したファイルはルートディレクトリまたは`backend/api/`配下か？
- [ ] `frontend/src/`または`backend/src/`配下のファイルを修正していないか？
- [ ] デプロイ先は公開物件サイト用のプロジェクトか？
- [ ] 管理画面に影響がないか確認したか？

---

## 📊 ファイルとプロジェクトのマッピング

| ファイル/ディレクトリ | 用途 | Vercelプロジェクト | デプロイコマンド |
|-------------------|------|------------------|----------------|
| `frontend/src/` | 管理画面（物件リスト・買主リスト） | `property-site-frontend`（管理画面） | `cd frontend && vercel --prod` |
| `backend/src/` | 管理画面バックエンド | `backend` | `cd backend && vercel --prod` |
| ルートディレクトリ（`index.html`など） | 公開物件サイト | `property-site-frontend`（公開サイト） | `vercel --prod` |
| `backend/api/` | 公開物件サイトバックエンド | `baikyaku-property-site3` | `cd backend && vercel --prod` |

---

## 🎯 過去の問題例

### 2026年2月12日: frontendディレクトリをデプロイして公開物件サイトが404エラー

**原因**:
- 物件リスト開発時に`frontend`ディレクトリをデプロイ
- ルートのVercelプロジェクト（公開物件サイト）が上書きされた
- 公開物件サイトが404エラーになった

**解決方法**:
- ルートディレクトリを再デプロイして元に戻した
- `vercel --prod`（ルートディレクトリから）

**教訓**:
- 物件リスト開発時は`frontend`ディレクトリをデプロイしない
- デプロイ先のプロジェクトを必ず確認する

---

## まとめ

**絶対に守るべきルール**:

1. **物件リスト開発時は`frontend/src/`と`backend/src/`のみを修正**
2. **公開物件サイト（ルートディレクトリと`backend/api/`）は絶対に触らない**
3. **デプロイ前に必ずデプロイ先のプロジェクトを確認**
4. **デプロイ後は公開物件サイトが正常に動作することを確認**
5. **問題が発生したらすぐにルートディレクトリを再デプロイ**

**このルールを徹底することで、公開物件サイトを壊すことなく、物件リストを開発できます。**

---

**最終更新日**: 2026年2月12日  
**作成理由**: 物件リスト開発時に公開物件サイトを壊した問題を防ぐため  
**関連する問題**: frontendディレクトリをデプロイして公開物件サイトが404エラーになった
