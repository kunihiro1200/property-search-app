---
inclusion: always
---

# スプレッドシートカラム名マッピング

## ⚠️ 重要：このファイルを必ず参照してください

スプレッドシート関連のコードを書く前に、**必ずこのファイルを確認**してください。
カラム名は変更されないため、ここに記録されたマッピングを使用してください。

---

## 📊 物件リストスプレッドシート

**スプレッドシートID**: `1tI_iXaiLuWBggs5y0RH7qzkbHs9wnLLdRekAmjkhcLY`  
**シート名**: `物件`

### カラム名マッピング

| データベースカラム | スプレッドシートカラム名 | 列 | 備考 |
|------------------|----------------------|-----|------|
| `property_number` | `物件番号` | A列 | 主キー |
| `atbb_status` | `atbb成約済み/非公開` | AA列 | `/`は改行ではなく記号 |
| `price` | `売買価格` | J列 | 万円単位 |
| `address` | `所在地` | F列 | 完全な住所 |
| `property_type` | `物件種別` | - | 戸建、マンション、土地など |
| `seller_name` | `売主名` | - | |
| `land_area` | `土地面積` | - | |
| `building_area` | `建物面積` | - | |
| `construction_year_month` | `築年月` | - | |
| `floor_plan` | `間取り` | - | |
| `storage_location` | **存在しない** | - | **物件リストスプレッドシートには存在しない。物件リスト（ブラウザ）のみに存在** |

### 重要な値のマッピング

#### 格納先URL（画像フォルダ）の取得元
**⚠️ 重要**: 物件リストスプレッドシートには「格納先URL」カラムは**存在しません**

画像取得の優先順位:
1. **物件リスト（ブラウザ）**: `property_listings.storage_location`（データベースカラム）
2. **業務リスト（スプレッドシート）**: 「格納先URL」カラム（CO列）

#### atbb_status（`atbb成約済み/非公開`カラム）の値
- `公開中` → 公開物件サイトに表示
- `公開前` → 準備中
- `非公開（配信メールのみ）` → メール配信のみ
- `成約済み` → 成約済み物件
- `未設定` または 空 → 未設定

---

## 📊 業務リスト（業務依頼）スプレッドシート

**スプレッドシートID**: `1MO2vs0mDUFCgM-rjXXPRIy3pKKdfIFvUDwacM-2174g`  
**シート名**: `業務依頼`  
**環境変数**: `GYOMU_LIST_SPREADSHEET_ID`

### ⚠️ 重要：おすすめコメントと画像URLの取得元

このスプレッドシートは、**おすすめコメント**と**画像URL**を取得するために使用します。

### カラム名マッピング

| 用途 | スプレッドシートカラム名 | 列 | 内容 |
|------|----------------------|-----|------|
| **おすすめコメント取得** | `スプシURL` | D列 | 個別物件スプレッドシートのURL |
| **画像URL取得** | `格納先URL` | CO列 | Google Driveフォルダ（画像格納先）のURL |
| 物件番号 | `物件番号` | - | 主キー（物件との紐付け） |

### データ取得フロー

#### おすすめコメント取得フロー
1. 業務リストの`スプシURL`（D列）から個別物件スプレッドシートURLを取得
2. 個別物件スプレッドシート内の`athome`シートを開く
3. 物件タイプに応じたセル範囲からおすすめコメントを取得:
   - 土地: `B63:L79`
   - 戸建て: `B152:L166`
   - マンション: `B149:L163`

#### 画像URL取得フロー
1. 業務リストの`格納先URL`（CO列）からGoogle DriveフォルダURLを取得
2. フォルダ内の画像URLを取得
3. 物件リスト（ブラウザ）の「格納先URL」にも同じURLが添付されている

### 重要な注意事項

- **業務リストにない物件**: 物件リスト（ブラウザ）の「格納先URL」から手動入力
- **データの優先順位**: 業務リスト → 物件リスト（ブラウザ）
- **個別物件スプレッドシート**: 各物件ごとに存在し、`athome`シートにおすすめコメントが格納されている

---

## 📊 売主リスト（業務リスト）スプレッドシート

**スプレッドシートID**: `1wKBRLWbT6pSKa9IlTDabjhjTnfs_GxX6Rn6M6kbio1I`  
**シート名**: `売主リスト`

### カラム名マッピング

| データベースカラム | スプレッドシートカラム名 | 備考 |
|------------------|----------------------|------|
| `seller_number` | `売主番号` | 主キー（AA形式） |
| `property_number` | `物件番号` | |
| `name` | `氏名・会社名` | 暗号化 |
| `address` | `住所` | 暗号化 |
| `phone_number` | `電話番号` | 暗号化 |
| `email` | `メールアドレス` | 暗号化 |
| `inquiry_date` | `反響日` | |
| `status` | `ステータス` | |

---

## 📊 買主リストスプレッドシート

**スプレッドシートID**: `1tI_iXaiLuWBggs5y0RH7qzkbHs9wnLLdRekAmjkhcLY`  
**シート名**: `買主リスト`

### カラム名マッピング

| データベースカラム | スプレッドシートカラム名 | 備考 |
|------------------|----------------------|------|
| `buyer_number` | `買主番号` | 主キー |
| `name` | `氏名・会社名` | |
| `phone_number` | `電話番号` | |
| `email` | `メールアドレス` | |
| `inquiry_source` | `問合せ元` | サイト、アットホームなど |
| `property_number` | `物件番号` | |
| `hearing` | `問合時ヒアリング` | |

---

## 🔧 コード実装時の注意事項

### 1. PropertyListingColumnMapperを使用する

カラム名のマッピングは`PropertyListingColumnMapper`クラスで一元管理されています。
**直接カラム名を書かず、必ずこのクラスを使用してください。**

```typescript
import { PropertyListingColumnMapper } from '../services/PropertyListingColumnMapper';

const mapper = new PropertyListingColumnMapper();

// スプレッドシートのデータをDBフォーマットに変換
const dbData = mapper.mapSpreadsheetToDatabase(spreadsheetRow);

// DBのデータをスプレッドシートフォーマットに変換
const sheetData = mapper.mapDatabaseToSpreadsheet(dbRow);
```

### 2. カラム名を直接参照する場合

やむを得ずカラム名を直接参照する場合は、このファイルに記載された正確な名前を使用してください。

```typescript
// ✅ 正しい
const atbbStatus = row['atbb成約済み/非公開'];
const price = row['売買価格'];
const address = row['所在地'];

// ❌ 間違い
const atbbStatus = row['ATBB状態']; // カラム名が違う
const price = row['価格']; // カラム名が違う
const address = row['住所']; // カラム名が違う
```

### 3. 新しいカラムを追加する場合

1. このファイルを更新
2. `PropertyListingColumnMapper`を更新
3. データベーススキーマを更新（必要な場合）

---

## 🎯 まとめ

- **カラム名は変更されない** → このファイルを信頼して使用
- **毎回確認しない** → このファイルに記録済み
- **PropertyListingColumnMapperを使用** → 一元管理
- **直接参照する場合** → このファイルの正確な名前を使用

**スプレッドシート関連のコードを書く前に、必ずこのファイルを確認してください。**
