---
inclusion: manual
---

# 別府市の住所ベースエリアマッピング定義

## ⚠️ 重要：別府市内の特定地域は複数エリアに該当する

別府市内の一部の地域は、市全域エリア（㊶）に加えて、**特定のエリア番号**にも該当します。

---

## 📋 別府市の住所ベースマッピング

### ⑨エリア（青山中学校エリア）

**住所パターン**:
- 南立石、堀田、南荘園、観海寺、鶴見園町、扇山、荘園
- 鶴見（7組・9組・ルミエールの丘を除く）

**該当エリア**:
- ✅ **⑨** ← 青山中学校エリア
- ✅ **㊶** ← 別府市全域
- ✅ **㊸** ← 鉄輪線より下エリア（南立石、南荘園、観海寺、鶴見園町、荘園のみ）

**例**:
- `別府市南立石1-1-1` → `⑨, ㊸, ㊶`
- `別府市堀田2-2-2` → `⑨, ㊶`
- `別府市南荘園3-3-3` → `⑨, ㊸, ㊶`
- `別府市観海寺4-4-4` → `⑨, ㊸, ㊶`
- `別府市鶴見園町5-5-5` → `⑨, ㊸, ㊶`
- `別府市扇山6-6-6` → `⑨, ㊶`
- `別府市荘園7-7-7` → `⑨, ㊸, ㊶`
- `別府市鶴見8-8-8` → `⑨, ㊶`（7組・9組・ルミエールの丘を除く）

---

### ⑩エリア（中部中学校エリア）

**住所パターン**:
- 荘園北町、緑丘町、東荘園

**該当エリア**:
- ✅ **⑩** ← 中部中学校エリア
- ✅ **㊶** ← 別府市全域
- ✅ **㊸** ← 鉄輪線より下エリア

**例**:
- `別府市荘園北町1-1-1` → `⑩, ㊸, ㊶`
- `別府市緑丘町2-2-2` → `⑩, ㊸, ㊶`
- `別府市東荘園3-3-3` → `⑩, ㊸, ㊶`

---

### ㊷エリア（別府駅周辺エリア）

**住所パターン**:
- 中央町、駅前本町、上田の湯町、野口中町、西野口町、駅前町

**該当エリア**:
- ✅ **㊷** ← 別府駅周辺エリア
- ✅ **㊶** ← 別府市全域

**例**:
- `別府市中央町1-1-1` → `㊷, ㊶`
- `別府市駅前本町2-2-2` → `㊷, ㊶`
- `別府市上田の湯町3-3-3` → `㊷, ㊶`
- `別府市野口中町4-4-4` → `㊷, ㊶`
- `別府市西野口町5-5-5` → `㊷, ㊶`
- `別府市駅前町6-6-6` → `㊷, ㊶`

---

### ㊸エリア（鉄輪線より下エリア）

**住所パターン**:
- 南立石、南荘園、観海寺、鶴見園町、荘園、荘園北町、緑丘町、東荘園
- 鶴見（7組・9組・ルミエールの丘のみ）

**該当エリア**:
- ✅ **㊸** ← 鉄輪線より下エリア
- ✅ **㊶** ← 別府市全域
- ✅ **⑨** または **⑩** ← 学校区エリア（地域による）

**例**:
- `別府市南立石1-1-1` → `⑨, ㊸, ㊶`
- `別府市南荘園2-2-2` → `⑨, ㊸, ㊶`
- `別府市観海寺3-3-3` → `⑨, ㊸, ㊶`
- `別府市鶴見園町4-4-4` → `⑨, ㊸, ㊶`
- `別府市荘園5-5-5` → `⑨, ㊸, ㊶`
- `別府市荘園北町6-6-6` → `⑩, ㊸, ㊶`
- `別府市緑丘町7-7-7` → `⑩, ㊸, ㊶`
- `別府市東荘園8-8-8` → `⑩, ㊸, ㊶`
- `別府市鶴見7組9-9-9` → `㊸, ㊶`
- `別府市鶴見9組10-10-10` → `㊸, ㊶`
- `別府市鶴見ルミエールの丘11-11-11` → `㊸, ㊶`

---

## 🔧 実装方法

### 1. BeppuAreaMappingServiceの修正（✅ 実装済み）

`backend/src/services/BeppuAreaMappingService.ts`に新しいエリアマッピングを追加しました。

**メソッド**:
```typescript
async getDistributionAreasForAddress(address: string): Promise<string | null>
```

**実装済みマッピングロジック**:
```typescript
// ⑨ 青山中学校エリア
const aoyamaAreas: Record<string, string> = {
  '南立石': '⑨㊸',
  '堀田': '⑨',
  '南荘園': '⑨㊸',
  '観海寺': '⑨㊸',
  '鶴見園町': '⑨㊸',
  '扇山': '⑨',
  '荘園': '⑨㊸',
  '鶴見': '⑨', // 7組・9組・ルミエールの丘を除く
};

// ⑩ 中部中学校エリア
const chubuAreas: Record<string, string> = {
  '荘園北町': '⑩㊸',
  '緑丘町': '⑩㊸',
  '東荘園': '⑩㊸',
};

// ㊷ 別府駅周辺エリア
const stationAreas: Record<string, string> = {
  '中央町': '㊷',
  '駅前本町': '㊷',
  '上田の湯町': '㊷',
  '野口中町': '㊷',
  '西野口町': '㊷',
  '駅前町': '㊷',
};

// ㊸ 鉄輪線より下エリア（特殊な鶴見）
const kannawaLineAreas: Record<string, string> = {
  '鶴見7組': '㊸',
  '鶴見9組': '㊸',
  '鶴見ルミエールの丘': '㊸',
};
```

---

### 2. PropertyDistributionAreaCalculatorの統合（✅ 実装済み）

`PropertyDistributionAreaCalculator`は既に`BeppuAreaMappingService`を使用しています。

**実装済み内容**:
```typescript
if (normalizedCity.includes('別府')) {
  // 別府市の場合、住所から詳細エリアを取得
  if (address) {
    const beppuAreas = await this.beppuAreaMappingService.getDistributionAreasForAddress(address);
    
    if (beppuAreas) {
      console.log(`[DistributionArea] Beppu detailed areas: ${beppuAreas}`);
      // 別府市の詳細エリア番号をパースして追加
      const detailedAreas = this.parseAreaNumbers(beppuAreas);
      cityWideAreas.push(...detailedAreas);
    } else {
      // マッピングが見つからない場合は別府市全体にフォールバック
      console.warn(`[DistributionArea] No detailed mapping found for ${address}, falling back to ㊶`);
      cityWideAreas.push('㊶');
    }
  } else {
    // 住所がない場合は別府市全体
    cityWideAreas.push('㊶');
  }
}
```

---

## 📝 今後の拡張

別府市内の他の地域で、特定のエリア番号に該当する地域がある場合は、`BeppuAreaMappingService`に追加してください。

**追加方法**:
```typescript
// 新しい地域を追加
const newAreas: Record<string, string> = {
  '地域名1': 'エリア番号',
  '地域名2': 'エリア番号',
};

if (newAreas[regionName]) {
  return newAreas[regionName];
}
```

---

## ✅ 実装完了

**実装済みエリア**:
- ✅ ⑨エリア（青山中学校エリア）: 8地域
- ✅ ⑩エリア（中部中学校エリア）: 3地域
- ✅ ㊷エリア（別府駅周辺エリア）: 6地域
- ✅ ㊸エリア（鉄輪線より下エリア）: 3地域（特殊な鶴見）

**動作確認**:
- ✅ `BeppuAreaMappingService`に新しいエリアマッピングを追加
- ✅ `PropertyDistributionAreaCalculator`に統合済み
- ✅ 近隣買主リストで正しくフィルタリングされる

---

## ✅ テスト

### テストケース1: 南立石（⑨㊸エリア）

**入力**:
- 住所: `別府市南立石1-1-1`
- Google Map URL: なし

**期待される出力**:
- エリア: `⑨, ㊸, ㊶`

### テストケース2: 堀田（⑨エリア）

**入力**:
- 住所: `別府市堀田2-2-2`
- Google Map URL: なし

**期待される出力**:
- エリア: `⑨, ㊶`

### テストケース3: 荘園北町（⑩㊸エリア）

**入力**:
- 住所: `別府市荘園北町1-1-1`
- Google Map URL: なし

**期待される出力**:
- エリア: `⑩, ㊸, ㊶`

### テストケース4: 中央町（㊷エリア）

**入力**:
- 住所: `別府市中央町1-1-1`
- Google Map URL: なし

**期待される出力**:
- エリア: `㊷, ㊶`

### テストケース5: 鶴見7組（㊸エリア）

**入力**:
- 住所: `別府市鶴見7組1-1-1`
- Google Map URL: なし

**期待される出力**:
- エリア: `㊸, ㊶`

### テストケース6: 鶴見（⑨エリア、7組・9組・ルミエールの丘を除く）

**入力**:
- 住所: `別府市鶴見1-1-1`
- Google Map URL: なし

**期待される出力**:
- エリア: `⑨, ㊶`

---

## まとめ

**別府市の住所ベースマッピング**:
- ⑨エリア（青山中学校エリア） → `⑨, ㊶`（一部は`⑨, ㊸, ㊶`）
- ⑩エリア（中部中学校エリア） → `⑩, ㊸, ㊶`
- ㊷エリア（別府駅周辺エリア） → `㊷, ㊶`
- ㊸エリア（鉄輪線より下エリア） → `㊸, ㊶`（一部は`⑨, ㊸, ㊶`または`⑩, ㊸, ㊶`）
- その他の別府市 → `㊶`のみ

**このルールを徹底することで、別府市内の特定地域が正しく複数のエリアに配信されます。**

---

**最終更新日**: 2026年2月5日  
**作成理由**: 別府市内の住所ベースエリアマッピングを完全に定義化するため  
**更新履歴**:
- 2026年2月5日: ⑨、⑩、㊷、㊸エリアを追加（合計20地域）
