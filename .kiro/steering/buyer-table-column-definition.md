# è²·ä¸»ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ å®šç¾©ï¼ˆçµ¶å¯¾ã«é–“é•ãˆãªã„ãƒ«ãƒ¼ãƒ«ï¼‰

## âš ï¸ é‡è¦ï¼šè²·ä¸»ã®è­˜åˆ¥å­

è²·ä¸»ã‚’è­˜åˆ¥ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®ã‚«ãƒ©ãƒ åã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

---

## âœ… æ­£ã—ã„ã‚«ãƒ©ãƒ å

### è²·ä¸»ã®è­˜åˆ¥å­

| ç”¨é€” | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ å | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚«ãƒ©ãƒ å | èª¬æ˜ |
|------|-------------------|---------------------|------|
| **è²·ä¸»ç•ªå·**ï¼ˆä¸»ã‚­ãƒ¼ï¼‰ | `buyer_number` | `è²·ä¸»ç•ªå·` | è²·ä¸»ã®ä¸€æ„è­˜åˆ¥å­ï¼ˆä¾‹: "6666"ï¼‰ |

**é‡è¦**: 
- âœ… **`buyer_number`** â† **ã“ã‚ŒãŒä¸»ã‚­ãƒ¼ï¼ˆè²·ä¸»ç•ªå·ï¼‰** â† **ã“ã‚Œã ã‘ã‚’ä½¿ç”¨ã™ã‚‹**
- âŒ **`buyer_id`** â† **å­˜åœ¨ã™ã‚‰ä¸è¦**ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­˜åœ¨ã™ã‚‹ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯å®Œå…¨ã«ç„¡è¦–ã™ã‚‹ï¼‰
- âŒ **`id`** â† **å­˜åœ¨ã—ãªã„**ï¼ˆçµ¶å¯¾ã«ä½¿ç”¨ã—ãªã„ï¼‰

**ğŸš¨ æœ€é‡è¦ãƒ«ãƒ¼ãƒ«**: 
- è²·ä¸»ã‚’è­˜åˆ¥ã™ã‚‹éš›ã¯ã€**å¸¸ã«`buyer_number`ã‚’ä½¿ç”¨ã™ã‚‹**
- `buyer_id`ã¯**å­˜åœ¨ã™ã‚‰ä¸è¦**ã§ã€**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã¯å®Œå…¨ã«ç„¡è¦–ã™ã‚‹**
- `buyer_id`ãŒNULLã§ã‚‚å•é¡Œãªã—ï¼ˆä¸»ã‚­ãƒ¼ã¯`buyer_number`ï¼‰

---

## ğŸš¨ ã‚ˆãã‚ã‚‹é–“é•ã„

### âŒ é–“é•ã„1: `id`ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨

```typescript
// âŒ é–“é•ã„ï¼ˆidã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„ï¼‰
const { data } = await supabase
  .from('buyers')
  .select('*')
  .eq('id', 'some-value');
```

### âŒ é–“é•ã„2: `buyer_id`ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨

```typescript
// âŒ é–“é•ã„ï¼ˆbuyer_idã¯å­˜åœ¨ã™ã‚‰ä¸è¦ï¼‰
const { data } = await supabase
  .from('buyers')
  .select('*')
  .eq('buyer_id', 'some-uuid');
```

**é‡è¦**: `buyer_id`ã¯**å­˜åœ¨ã™ã‚‰ä¸è¦**ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­˜åœ¨ã—ã¦ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã¯å®Œå…¨ã«ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚

### âœ… æ­£ã—ã„æ–¹æ³•: è²·ä¸»ç•ªå·ã§æ¤œç´¢

```typescript
// âœ… æ­£ã—ã„ï¼ˆbuyer_numberã§æ¤œç´¢ï¼‰
const { data } = await supabase
  .from('buyers')
  .select('*')
  .eq('buyer_number', '6666');
```

---

## ğŸ“‹ ä¸»è¦ã‚«ãƒ©ãƒ ã®ãƒãƒƒãƒ”ãƒ³ã‚°

### åŸºæœ¬æƒ…å ±

| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ å | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚«ãƒ©ãƒ å | èª¬æ˜ |
|-------------------|---------------------|------|
| `buyer_number` | `è²·ä¸»ç•ªå·` | è²·ä¸»ã®ä¸€æ„è­˜åˆ¥å­ |
| `name` | `â—æ°åãƒ»ä¼šç¤¾å` | è²·ä¸»å |
| `phone` | `â—é›»è©±ç•ªå·\nï¼ˆãƒã‚¤ãƒ•ãƒ³ä¸è¦ï¼‰` | é›»è©±ç•ªå· |
| `email` | `â—ãƒ¡ã‚¢ãƒ‰` | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| `inquiry_source` | `â—å•åˆã›å…ƒ` | å•ã„åˆã‚ã›å…ƒ |

### å•ã„åˆã‚ã›æƒ…å ±

| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ å | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚«ãƒ©ãƒ å | èª¬æ˜ |
|-------------------|---------------------|------|
| `property_number` | `ç‰©ä»¶ç•ªå·` | åˆå›å•ã„åˆã‚ã›ç‰©ä»¶ç•ªå· |
| `inquiry_hearing` | `â—å•åˆæ™‚ãƒ’ã‚¢ãƒªãƒ³ã‚°` | å•ã„åˆã‚ã›æ™‚ãƒ’ã‚¢ãƒªãƒ³ã‚° |
| `reception_date` | `å—ä»˜æ—¥` | å—ä»˜æ—¥ |

### å†…è¦§æƒ…å ±

| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ å | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚«ãƒ©ãƒ å | èª¬æ˜ |
|-------------------|---------------------|------|
| `latest_viewing_date` | `å†…è¦§æ—¥ï¼ˆæœ€æ–°ï¼‰` | æœ€æ–°ã®å†…è¦§æ—¥ |
| `viewing_time` | `ãƒ»æ™‚é–“` | å†…è¦§æ™‚é–“ |
| `follow_up_assignee` | `å¾Œç¶šæ‹…å½“` | å¾Œç¶šæ‹…å½“è€… |
| `viewing_result_follow_up` | `å†…è¦§çµæœãƒ»å¾Œç¶šå¯¾å¿œ` | å†…è¦§çµæœã¨å¾Œç¶šå¯¾å¿œ |

### ãã®ä»–

| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ å | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚«ãƒ©ãƒ å | èª¬æ˜ |
|-------------------|---------------------|------|
| `latest_status` | `â˜…æœ€æ–°çŠ¶æ³` | æœ€æ–°çŠ¶æ³ |
| `pre_viewing_notes` | `å†…è¦§å‰ä¼é”äº‹é …` | å†…è¦§å‰ä¼é”äº‹é … |
| `viewing_notes` | `å†…è¦§ãƒ¡ãƒ¢` | å†…è¦§ãƒ¡ãƒ¢ |

---

## ğŸ¯ å®Ÿè£…ä¾‹

### ä¾‹1: è²·ä¸»ç•ªå·ã§æ¤œç´¢

```typescript
// âœ… æ­£ã—ã„
const { data: buyer } = await supabase
  .from('buyers')
  .select('*')
  .eq('buyer_number', '6666')
  .single();

console.log('è²·ä¸»ç•ªå·:', buyer.buyer_number);
console.log('è²·ä¸»å:', buyer.name);
console.log('å†…è¦§æ—¥:', buyer.latest_viewing_date);
```

### ä¾‹2: è²·ä¸»ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°

```typescript
// âœ… æ­£ã—ã„
await supabase
  .from('buyers')
  .update({
    latest_viewing_date: '2026-02-05',
    viewing_time: '14:30',
    follow_up_assignee: 'Y'
  })
  .eq('buyer_number', '6666');
```

---

## ğŸ“ BuyerServiceã®å®Ÿè£…

### getById ãƒ¡ã‚½ãƒƒãƒ‰

**é‡è¦**: `getById`ãƒ¡ã‚½ãƒƒãƒ‰ã¯**ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„**ã€‚è²·ä¸»ç•ªå·ã§æ¤œç´¢ã™ã‚‹å ´åˆã¯`getByBuyerNumber`ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

```typescript
// âŒ ä½¿ç”¨ã—ãªã„ï¼ˆbuyer_idã¯å­˜åœ¨ã™ã‚‰ä¸è¦ï¼‰
async getById(id: string): Promise<any | null> {
  // ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä½¿ç”¨ã—ãªã„
}

// âœ… æ­£ã—ã„ï¼ˆbuyer_numberã§æ¤œç´¢ - è²·ä¸»ç•ªå·ï¼‰
async getByBuyerNumber(buyerNumber: string): Promise<any | null> {
  const { data, error } = await this.supabase
    .from('buyers')
    .select('*')
    .eq('buyer_number', buyerNumber)  // â† buyer_numberï¼ˆä¸»ã‚­ãƒ¼ï¼‰ã§æ¤œç´¢
    .single();
  
  return data;
}
```

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: "Buyer not found"ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: 
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ`/api/buyers/:id`ãŒ404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
- ãƒ–ãƒ©ã‚¦ã‚¶ã§"Buyer not found"ã¨è¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **:
1. `buyer_id`ã‚«ãƒ©ãƒ ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ˆå­˜åœ¨ã—ãªã„ï¼‰
2. `buyer_number`ãŒæ­£ã—ãæ¸¡ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```typescript
// âŒ é–“é•ã„
.eq('buyer_id', buyerNumber)

// âœ… æ­£ã—ã„
.eq('buyer_number', buyerNumber)
```

---

### å•é¡Œ2: UUIDã¨buyer_numberã®æ··åŒ

**ç—‡çŠ¶**:
- UUIDã‚’`buyer_number`ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã‚‹
- `buyer_number`ã‚’UUIDã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•**:
- `buyer_id`ï¼ˆUUIDï¼‰: **å­˜åœ¨ã™ã‚‰ä¸è¦**ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­˜åœ¨ã—ã¦ã‚‚ç„¡è¦–ï¼‰
- `buyer_number`ï¼ˆæ–‡å­—åˆ—ï¼‰: è²·ä¸»ç•ªå·ï¼ˆä¾‹: "6666"ï¼‰â† **ã“ã‚ŒãŒä¸»ã‚­ãƒ¼**

```typescript
// âœ… æ­£ã—ã„ä½¿ã„æ–¹
const buyer = await buyerService.getByBuyerNumber('6666');  // è²·ä¸»ç•ªå·ã§æ¤œç´¢
console.log(buyer.buyer_number);  // è²·ä¸»ç•ªå·ï¼ˆ"6666"ï¼‰â† ä¸»ã‚­ãƒ¼
// buyer.buyer_idã¯ä½¿ç”¨ã—ãªã„ï¼ˆå­˜åœ¨ã™ã‚‰ä¸è¦ï¼‰
```

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `.kiro/steering/seller-table-column-definition.md` - å£²ä¸»ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ å®šç¾©ï¼ˆå‚è€ƒï¼‰

---

## ã¾ã¨ã‚

**çµ¶å¯¾ã«å®ˆã‚‹ã¹ããƒ«ãƒ¼ãƒ«**:

1. **è²·ä¸»ç•ªå·ã¯`buyer_number`** â† ã“ã‚ŒãŒä¸»ã‚­ãƒ¼
2. **`buyer_id`ã¯å­˜åœ¨ã™ã‚‰ä¸è¦** â† ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­˜åœ¨ã—ã¦ã‚‚å®Œå…¨ã«ç„¡è¦–ã™ã‚‹
3. **`id`ã‚«ãƒ©ãƒ ã¯å­˜åœ¨ã—ãªã„** â† çµ¶å¯¾ã«ä½¿ç”¨ã—ãªã„
4. **`getById`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä½¿ç”¨ã—ãªã„** â† buyer_idã‚’ä½¿ã†ãŸã‚
5. **`getByBuyerNumber`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨** â† ä¸»ã‚­ãƒ¼æ¤œç´¢ç”¨ï¼ˆæ¨å¥¨ï¼‰
6. **`buyer_id`ãŒNULLã§ã‚‚å•é¡Œãªã—** â† ä¸»ã‚­ãƒ¼ã¯buyer_number

**ã“ã®ãƒ«ãƒ¼ãƒ«ã‚’å¾¹åº•ã™ã‚‹ã“ã¨ã§ã€ã‚«ãƒ©ãƒ åã®é–“é•ã„ã‚’å®Œå…¨ã«é˜²æ­¢ã§ãã¾ã™ã€‚**

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2026å¹´2æœˆ6æ—¥  
**ä½œæˆç†ç”±**: buyer_idã¯å­˜åœ¨ã™ã‚‰ä¸è¦ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ãŸã‚  
**æ›´æ–°å±¥æ­´**:
- 2026å¹´2æœˆ6æ—¥: buyer_idã¯å­˜åœ¨ã™ã‚‰ä¸è¦ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºåŒ–ã€getByIdãƒ¡ã‚½ãƒƒãƒ‰ã¯ä½¿ç”¨ã—ãªã„ã“ã¨ã‚’è¿½åŠ 
- 2026å¹´2æœˆ5æ—¥: buyer_idã¨buyer_numberã®æ··åŒã‚’é˜²ãã€ã‚«ãƒ©ãƒ åã‚’æ˜ç¢ºåŒ–ã™ã‚‹ãŸã‚

