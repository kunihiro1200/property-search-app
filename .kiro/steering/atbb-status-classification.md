---
inclusion: always
---

# atbb_status 分類定義

## ⚠️ 重要：この分類は絶対に守ること

このファイルは、`atbb_status`カラムの値を「公開」と「非公開（成約済み）」に分類する定義です。
**何度も質問せず、このファイルを参照してください。**

---

## 公開物件（「公開中のみ表示」でONの時に表示する）

以下の`atbb_status`値を持つ物件を表示：

1. **専任・公開中**
2. **一般・公開中**
3. **非公開（配信メールのみ）** ← 公開に含める

---

## 非公開物件（成約済み）（「公開中のみ表示」でONの時に除外する）

以下の`atbb_status`値を持つ物件を除外：

1. **E外し非公開**
2. **ステータスなし**
3. **他社物件**
4. **非公開（一般）**
5. **非公開（専任）**
6. **非公開** （単独）

---

## null値の扱い

- `atbb_status`が`null`または空文字列の物件は、「公開中のみ表示」でONの時に**除外**する

---

## 実装方法

### ✅ 正しい実装（ホワイトリスト方式）

公開物件のみを明示的に指定：

```typescript
if (showPublicOnly) {
  // 公開物件のみを表示（ホワイトリスト）
  query = query.in('atbb_status', [
    '専任・公開中',
    '一般・公開中',
    '非公開（配信メールのみ）'
  ]);
}
```

### ❌ 間違った実装（ブラックリスト方式）

非公開物件を除外する方式は、新しい値が追加された時に対応できないため推奨しません。

---

## データベースの現在の分布（参考）

```
公開物件:
  - 専任・公開中: 57件
  - 一般・公開中: 42件
  - 非公開（配信メールのみ）: 2件
  合計: 101件

非公開物件（成約済み）:
  - 非公開（専任）: 509件
  - E外し非公開: 323件
  - 非公開（一般）: 56件
  - 他社物件: 7件
  - ステータスなし: 2件
  - 非公開: 1件
  - 公開中: 1件（レアケース）
  合計: 899件

null: 118件（除外）

総計: 1,118件
```

---

## 変更履歴

- 2026-01-25: 初版作成
- 2026-01-25: 「公開中」を公開物件リストから削除（実質的に存在しないため）

---

## 注意事項

- **このファイルを必ず参照すること**
- **ユーザーに何度も質問しないこと**
- **新しい`atbb_status`値が追加された場合、ユーザーに確認してこのファイルを更新すること**
