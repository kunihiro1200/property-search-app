# 本番環境のキャッシュクリア手順

## 問題
本番環境（`https://property-site-frontend-kappa.vercel.app`）で、古いデータやコードがキャッシュされている可能性があります。

## 症状
- 検索機能が正しく動作しない（例: EE2で検索すると多数の物件が表示される）
- 最新の修正が反映されていない
- 古いバージョンのJavaScriptが実行されている

## 解決手順

### 1. ブラウザのキャッシュとCookieを完全にクリア

#### Chrome / Edge の場合:
1. `Ctrl + Shift + Delete` を押す
2. 「期間」を **「全期間」** に設定
3. 以下をすべてチェック:
   - ✅ 閲覧履歴
   - ✅ Cookieと他のサイトデータ
   - ✅ キャッシュされた画像とファイル
   - ✅ サイトの設定
   - ✅ ホストされているアプリのデータ
4. 「データを削除」をクリック
5. **ブラウザを完全に閉じる**（すべてのウィンドウを閉じる）

#### Firefox の場合:
1. `Ctrl + Shift + Delete` を押す
2. 「消去する履歴の期間」を **「すべての履歴」** に設定
3. 以下をすべてチェック:
   - ✅ 表示したページとダウンロードの履歴
   - ✅ Cookie
   - ✅ キャッシュ
   - ✅ サイトの設定
4. 「今すぐ消去」をクリック
5. **ブラウザを完全に閉じる**

### 2. ローカルストレージを手動でクリア（念のため）

1. ブラウザを開く
2. `F12` を押して開発者ツールを開く
3. 「Application」タブ（Chromeの場合）または「ストレージ」タブ（Firefoxの場合）を開く
4. 左側の「Local Storage」を展開
5. `https://property-site-frontend-kappa.vercel.app` を右クリック → 「Clear」
6. 「Session Storage」も同様にクリア
7. 「Cookies」も同様にクリア

### 3. スーパーリロード（強制再読み込み）

ブラウザを開いて、本番サイトにアクセスした後:

- **Chrome / Edge**: `Ctrl + Shift + R` または `Ctrl + F5`
- **Firefox**: `Ctrl + Shift + R` または `Ctrl + F5`

### 4. 新しいブラウザウィンドウでアクセス

1. **新しいブラウザウィンドウ**を開く（既存のウィンドウは使わない）
2. `https://property-site-frontend-kappa.vercel.app` にアクセス
3. 検索機能をテスト

### 5. それでもダメな場合

#### A. 別のブラウザで試す
- Chrome → Edge または Firefox
- Edge → Chrome または Firefox
- Firefox → Chrome または Edge

#### B. シークレットモード/プライベートブラウジングで試す
- Chrome: `Ctrl + Shift + N`
- Edge: `Ctrl + Shift + N`
- Firefox: `Ctrl + Shift + P`

シークレットモードでアクセス:
```
https://property-site-frontend-kappa.vercel.app
```

#### C. 別のデバイスで試す
- スマートフォン
- タブレット
- 別のPC

### 6. 確認方法

本番サイト（`https://property-site-frontend-kappa.vercel.app`）で:

1. `F12` を押して開発者ツールを開く
2. 「Network」タブを開く
3. 「Disable cache」にチェックを入れる
4. ページをリロード（`Ctrl + R`）
5. 検索バーに「EE2」と入力して検索
6. ネットワークリクエストを確認:
   - ✅ `https://baikyaku-property-site3.vercel.app/api/public/properties?propertyNumber=EE2` にリクエストが送信される
   - ✅ レスポンスで1件のみ返される（EE2のみ）

### 7. 開発者ツールでキャッシュを無効化（テスト用）

1. `F12` を押して開発者ツールを開く
2. 「Network」タブを開く
3. 「Disable cache」にチェックを入れる
4. **開発者ツールを開いたまま**ページを使用

この状態では、すべてのリクエストがキャッシュされずに実行されます。

## 検索機能のテスト手順

### テスト1: 物件番号検索（完全一致）
1. 検索バーに「EE2」と入力
2. 検索ボタンをクリック
3. **期待される結果**: EE2のみが表示される（1件）
4. **問題がある場合**: 複数の物件が表示される

### テスト2: 所在地検索（部分一致）
1. 検索バーに「大分市」と入力
2. 検索ボタンをクリック
3. **期待される結果**: 大分市を含む住所の物件が複数表示される
4. **問題がある場合**: 検索結果が表示されない

### テスト3: 物件番号検索（他の物件）
1. 検索バーに「CC21」と入力
2. 検索ボタンをクリック
3. **期待される結果**: CC21のみが表示される（1件）
4. **問題がある場合**: 複数の物件が表示される

## トラブルシューティング

### 「EE2で検索すると多数の物件が表示される」場合

**原因**: ブラウザまたはReact Queryのキャッシュが古い

**解決策**:
1. 上記の手順1〜3を実行（キャッシュクリア + スーパーリロード）
2. シークレットモードで試す
3. 別のブラウザで試す

### 「検索しても何も表示されない」場合

**原因**: APIエラーまたはネットワーク問題

**解決策**:
1. `F12` を押して開発者ツールを開く
2. 「Console」タブでエラーを確認
3. 「Network」タブでAPIリクエストを確認
4. APIが正しく動作しているか確認:
   ```
   https://baikyaku-property-site3.vercel.app/api/public/properties?propertyNumber=EE2
   ```

### React Queryのキャッシュをクリア

開発者ツールのコンソールで以下を実行:

```javascript
// React Queryのキャッシュをクリア
localStorage.clear();
sessionStorage.clear();
location.reload();
```

## 重要なポイント

- **ブラウザを完全に閉じる**: タブを閉じるだけでは不十分。すべてのウィンドウを閉じる
- **新しいウィンドウで開く**: 既存のウィンドウは古いキャッシュを持っている可能性がある
- **シークレットモードを試す**: 最もクリーンな環境でテストできる
- **開発者ツールの「Disable cache」を使用**: テスト時にキャッシュを無効化

## Vercelのキャッシュについて

Vercelは自動的にキャッシュを管理しますが、以下の場合にキャッシュがクリアされます:

1. **新しいデプロイ**: 新しいバージョンがデプロイされると、古いキャッシュは自動的にクリアされます
2. **ビルドID**: 各ビルドには一意のIDが割り当てられ、JavaScriptファイル名に含まれます（例: `main.abc123.js`）

**注意**: Vercelのキャッシュは自動的に管理されるため、通常は手動でクリアする必要はありません。問題がある場合は、ブラウザのキャッシュをクリアしてください。

## 最終確認

すべての手順を実行した後、以下を確認してください:

1. ✅ EE2で検索すると、EE2のみが表示される
2. ✅ 大分市で検索すると、大分市を含む住所の物件が表示される
3. ✅ CC21で検索すると、CC21のみが表示される
4. ✅ 地図ビューでEE2が青いマーカーで表示される
5. ✅ リストビューでEE2が表示される

すべて確認できたら、キャッシュクリアは成功です！

## サポート

問題が解決しない場合は、以下の情報を提供してください:

1. 使用しているブラウザとバージョン
2. 実行した手順
3. 開発者ツールのコンソールエラー（スクリーンショット）
4. ネットワークタブのAPIリクエスト（スクリーンショット）
